(function(n,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(n=typeof globalThis<"u"?globalThis:n||self,m(n.FMGofer={}))})(this,function(n){"use strict";const x="The FM script call timed out",l="fmGoferCallbackD7738642C91848E08720EAC24EDDA483";function I(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,t=>{var r=Math.random()*16|0,e=t=="x"?r:r&3|8;return e.toString(16)})}function v(){return typeof window.fmGofer=="object"&&window.fmGofer!==null&&!Array.isArray(window.fmGofer)}function h(){v()||(window.fmGofer={promises:{},callbackName:l},window[l]=G)}function D(o,t,r,e){const i=I(),f={resolve:o,reject:t};return r!==0&&(f.timeoutID=setTimeout(()=>{f.fmOnReadyIntervalID&&clearInterval(f.fmOnReadyIntervalID),d(i),t(e)},r)),window.fmGofer.promises[i]=f,i}function b(o){return window.fmGofer.promises[o]}function d(o){var r,e;const t=(e=(r=window.fmGofer)==null?void 0:r.promises)==null?void 0:e[o];return t&&(t.timeoutID&&clearTimeout(t.timeoutID),t.fmOnReadyIntervalID&&clearInterval(t.fmOnReadyIntervalID)),delete window.fmGofer.promises[o]}function G(o,t,r){try{r==="0"&&(r="");const e=b(o);if(typeof e>"u")throw new Error(`No promise found for promiseID ${o}.`);e.timeoutID&&clearTimeout(e.timeoutID),r?e.reject(t):e.resolve(t),d(o)}catch(e){console.error(e)}}function O(o,t,r){let e;return{promise:new Promise((f,a)=>{if(typeof window.FileMaker=="object"){window.FileMaker.PerformScriptWithOption(o,t,r);return}const s=5,u=2e3;let c=0;e=setInterval(()=>{c+=s,c>u&&(clearInterval(e),a(`window.FileMaker not found within ${u} ms`)),typeof window.FileMaker=="object"&&(clearInterval(e),window.FileMaker.PerformScriptWithOption(o,t,r),f())},s)}),intervalID:e}}function M(o){const t=Object.create(o);return t.json=function(){return this.then(r=>JSON.parse(r))},t}function p(o,t,r,e=15e3,i=x){if(typeof o!="string"||!o)throw new Error("script must be a string");if(typeof e!="number")throw new Error("timeout must be a number");if(typeof i!="string")throw new Error("timeoutMessage must be a string");return M(new Promise(async(f,a)=>{h();const s=D(f,a,e,i),u={promiseID:s,callbackName:l,parameter:t},c=JSON.stringify(u);try{const{promise:w,intervalID:g}=O(o,c,r);window.fmGofer.promises[s].fmOnReadyIntervalID=g,await w}catch(w){d(s),a(w)}}))}function y(o,t=void 0,r=15e3,e=x){return p(o,t,void 0,r,e)}const P={PerformScript:y,PerformScriptWithOption:p};n.PerformScript=y,n.PerformScriptWithOption=p,n.default=P,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
