(function(n,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(n=typeof globalThis<"u"?globalThis:n||self,a(n.FMGofer={}))})(this,function(n){"use strict";const x="The FM script call timed out",l="fmGoferCallbackD7738642C91848E08720EAC24EDDA483";function I(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,t=>{var r=Math.random()*16|0,e=t=="x"?r:r&3|8;return e.toString(16)})}function v(){return typeof window.fmGofer=="object"&&window.fmGofer!==null&&!Array.isArray(window.fmGofer)}function h(){v()||(window.fmGofer={promises:{},callbackName:l},window[l]=b)}function D(o,t,r,e){const i=I(),f={resolve:o,reject:t};return r!==0&&(f.timeoutID=setTimeout(()=>{f.fmOnReadyIntervalID&&clearInterval(f.fmOnReadyIntervalID),d(i),t(e)},r)),window.fmGofer.promises[i]=f,i}function G(o){return window.fmGofer.promises[o]}function d(o){var r,e;const t=(e=(r=window.fmGofer)==null?void 0:r.promises)==null?void 0:e[o];return t&&(t.timeoutID&&clearTimeout(t.timeoutID),t.fmOnReadyIntervalID&&clearInterval(t.fmOnReadyIntervalID)),delete window.fmGofer.promises[o]}function b(o,t,r){try{r==="0"&&(r="");const e=G(o);if(typeof e>"u")throw new Error(`No promise found for promiseID ${o}.`);e.timeoutID&&clearTimeout(e.timeoutID),r?e.reject(t):e.resolve(t),d(o)}catch(e){console.error(e)}}function M(o,t,r){let e;return{promise:new Promise((f,m)=>{if(typeof window.FileMaker=="object"){window.FileMaker.PerformScriptWithOption(o,t,r);return}const s=5,c=2e3;let u=0;e=setInterval(()=>{u+=s,u>c&&(clearInterval(e),m(`window.FileMaker not found within ${c} ms`)),typeof window.FileMaker=="object"&&(clearInterval(e),window.FileMaker.PerformScriptWithOption(o,t,r),f())},s)}),intervalID:e}}class O extends Promise{async json(){const t=await this;return JSON.parse(t)}}function p(o,t,r,e=15e3,i=x){if(typeof o!="string"||!o)throw new Error("script must be a string");if(typeof e!="number")throw new Error("timeout must be a number");if(typeof i!="string")throw new Error("timeoutMessage must be a string");return new O(async(f,m)=>{h();const s=D(f,m,e,i),c={promiseID:s,callbackName:l,parameter:t},u=JSON.stringify(c);try{const{promise:w,intervalID:S}=M(o,u,r);window.fmGofer.promises[s].fmOnReadyIntervalID=S,await w}catch(w){d(s),m(w)}})}function y(o,t=void 0,r=15e3,e=x){return p(o,t,void 0,r,e)}const P={PerformScript:y,PerformScriptWithOption:p};n.PerformScript=y,n.PerformScriptWithOption=p,n.default=P,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
