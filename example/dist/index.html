<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fm-gofer example</title>
  <!-- Scroll to the body for example usage -->
  
  
  <script type="module" crossorigin>
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();const m="The FM script call timed out",a="fmGoferCallbackD7738642C91848E08720EAC24EDDA483";function x(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,o=>{var r=Math.random()*16|0,n=o=="x"?r:r&3|8;return n.toString(16)})}function y(){return typeof window.fmGofer=="object"&&window.fmGofer!==null&&!Array.isArray(window.fmGofer)}function I(){y()||(window.fmGofer={promises:{},callbackName:a},window[a]=D)}function v(o,r,n,e){const t=x(),i={resolve:o,reject:r};return n!==0&&(i.timeoutID=setTimeout(()=>{i.fmOnReadyIntervalID&&clearInterval(i.fmOnReadyIntervalID),u(t),r(e)},n)),window.fmGofer.promises[t]=i,t}function h(o){return window.fmGofer.promises[o]}function u(o){var r,n;const e=(n=(r=window.fmGofer)==null?void 0:r.promises)==null?void 0:n[o];return e&&(e.timeoutID&&clearTimeout(e.timeoutID),e.fmOnReadyIntervalID&&clearInterval(e.fmOnReadyIntervalID)),delete window.fmGofer.promises[o]}function D(o,r,n){try{n==="0"&&(n="");const e=h(o);if(typeof e>"u")throw new Error(`No promise found for promiseID ${o}.`);e.timeoutID&&clearTimeout(e.timeoutID),n?e.reject(r):e.resolve(r),u(o)}catch(e){console.error(e)}}function g(o,r,n){let e;return{promise:new Promise((t,i)=>{if(typeof window.FileMaker=="object"){window.FileMaker.PerformScriptWithOption(o,r,n);return}const s=5,f=2e3;let c=0;e=setInterval(()=>{c+=s,c>f&&(clearInterval(e),i(`window.FileMaker not found within ${f} ms`)),typeof window.FileMaker=="object"&&(clearInterval(e),window.FileMaker.PerformScriptWithOption(o,r,n),t())},s)}),intervalID:e}}class b extends Promise{async json(){const r=await this;return JSON.parse(r)}}function d(o,r,n,e=15e3,t=m){if(typeof o!="string"||!o)throw new Error("script must be a string");if(typeof e!="number")throw new Error("timeout must be a number");if(typeof t!="string")throw new Error("timeoutMessage must be a string");return new b(async(i,s)=>{I();const f=v(i,s,e,t),c={promiseID:f,callbackName:a,parameter:r},w=JSON.stringify(c);try{const{promise:l,intervalID:p}=g(o,w,n);window.fmGofer.promises[f].fmOnReadyIntervalID=p,await l}catch(l){u(f),s(l)}})}function O(o,r=void 0,n=15e3,e=m){return d(o,r,void 0,n,e)}const G={PerformScript:O,PerformScriptWithOption:d};window.FMGofer=G;

</script>
  <style type="text/css">
*{font-family:Arial,Helvetica,sans-serif;color:#fff;margin:10px;text-align:center}body{background-color:#223339}button{padding:10pt;font-size:medium;border:.5pt solid #007fb5;border-radius:5pt;background-color:#0091ce;color:#fff}button:active{background-color:#007cb1}.message{margin-top:10pt;margin-bottom:10pt;font-size:large}.loader{color:#9c9c9c;font-size:20px;margin:100px auto;width:1em;height:1em;border-radius:50%;position:relative;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,to{box-shadow:0 -3em 0 .2em,2em -2em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em}12.5%{box-shadow:0 -3em,2em -2em 0 .2em,3em 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em,3em 0 0 .2em,2em 2em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0,2em 2em 0 .2em,0 3em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em,0 3em 0 .2em,-2em 2em,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em,-2em 2em 0 .2em,-3em 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0 0 .2em,-2em -2em}87.5%{box-shadow:0 -3em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0,-2em -2em 0 .2em}}@keyframes load4{0%,to{box-shadow:0 -3em 0 .2em,2em -2em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em}12.5%{box-shadow:0 -3em,2em -2em 0 .2em,3em 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em,3em 0 0 .2em,2em 2em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0,2em 2em 0 .2em,0 3em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em,0 3em 0 .2em,-2em 2em,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em,-2em 2em 0 .2em,-3em 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0 0 .2em,-2em -2em}87.5%{box-shadow:0 -3em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0,-2em -2em 0 .2em}}

</style>
</head>

<body>
  <button id="myButtonJSON">Click For JSON</button>
  <button id="myButton">Click For... Not JSON</button>
  <div id="message" class="message">Click the button to get a message</div>
  <div id="loader" class="loader" hidden>Loading...</div>
  <script>
    (async function () {
      async function handleClick(askForJson = false) {
        console.log('askForJson', askForJson)
        const script = 'FM Script';
        const timeout = 1000;
        const timeoutMessage = 'Custom timeout message. The webviewer code elected to only wait for ' + timeout + 'ms.';
        updateMessage('Waiting...');
        showLoader();
        if (askForJson) {
          const param = "DEAR FM, PLEASE SEND JSON!";
          try {
            const res = await FMGofer.PerformScript(script, param, timeout, timeoutMessage).json();
            console.log('res', res);
            // re-stringifying the parsed json to display in ui, but you can view the parsed json in the console
            updateMessage(JSON.stringify(res), 'ü§ñ');
          } catch (error) {
            updateMessage(error, 'üòµ');
          } finally {
            hideLoader();
          }

        } else {
          try {
            const param = 'HELLO FROM JS ' + new Date();
            const res = await FMGofer.PerformScript(script, param, timeout, timeoutMessage);
            updateMessage(res, 'üòç');
          } catch (error) {
            updateMessage(error, 'üòµ');
          } finally {
            hideLoader();
          }
        }
      }
      function showLoader() {
        document.getElementById('loader').hidden = false;
      }
      function hideLoader() {
        document.getElementById('loader').hidden = true;
      }
      function updateMessage(message, emoji) {
        var html = message;
        if (emoji) {
          html += '<div style="font-size: 4rem;">' + emoji + '</div>';
        }
        document.getElementById('message').innerHTML = html;
      }

      document.getElementById('myButtonJSON').onclick = () => handleClick(true);
      document.getElementById('myButton').onclick = () => handleClick(false);
    })();
  </script>
</body>

</html>