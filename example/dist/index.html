<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fm-gofer example</title>
  <!-- Scroll to the body for example usage -->
  
  
  <script type="module" crossorigin>
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&e(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const m="The FM script call timed out",u="fmGoferCallbackD7738642C91848E08720EAC24EDDA483";function x(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,t=>{var r=Math.random()*16|0,n=t=="x"?r:r&3|8;return n.toString(16)})}function y(){return typeof window.fmGofer=="object"&&window.fmGofer!==null&&!Array.isArray(window.fmGofer)}function I(){y()||(window.fmGofer={promises:{},callbackName:u},window[u]=D)}function v(t,r,n,e){const o=x(),i={resolve:t,reject:r};return n!==0&&(i.timeoutID=setTimeout(()=>{i.fmOnReadyIntervalID&&clearInterval(i.fmOnReadyIntervalID),a(o),r(e)},n)),window.fmGofer.promises[o]=i,o}function h(t){return window.fmGofer.promises[t]}function a(t){var r,n;const e=(n=(r=window.fmGofer)==null?void 0:r.promises)==null?void 0:n[t];return e&&(e.timeoutID&&clearTimeout(e.timeoutID),e.fmOnReadyIntervalID&&clearInterval(e.fmOnReadyIntervalID)),delete window.fmGofer.promises[t]}function D(t,r,n){try{n==="0"&&(n="");const e=h(t);if(typeof e>"u")throw new Error(`No promise found for promiseID ${t}.`);e.timeoutID&&clearTimeout(e.timeoutID),n?e.reject(r):e.resolve(r),a(t)}catch(e){console.error(e)}}function b(t,r,n){let e;return{promise:new Promise((o,i)=>{if(typeof window.FileMaker=="object"){window.FileMaker.PerformScriptWithOption(t,r,n);return}const f=5,s=2e3;let c=0;e=setInterval(()=>{c+=f,c>s&&(clearInterval(e),i(`window.FileMaker not found within ${s} ms`)),typeof window.FileMaker=="object"&&(clearInterval(e),window.FileMaker.PerformScriptWithOption(t,r,n),o())},f)}),intervalID:e}}function g(t){const r=Object.create(t);return r.json=function(){return this.then(n=>JSON.parse(n))},r}function d(t,r,n,e=0,o=m){if(typeof t!="string"||!t)throw new Error("script must be a string");if(typeof e!="number")throw new Error("timeout must be a number");if(typeof o!="string")throw new Error("timeoutMessage must be a string");return g(new Promise(async(i,f)=>{I();const s=v(i,f,e,o),c={promiseID:s,callbackName:u,parameter:r},w=JSON.stringify(c);try{const{promise:l,intervalID:p}=b(t,w,n);window.fmGofer.promises[s].fmOnReadyIntervalID=p,await l}catch(l){a(s),f(l)}}))}function O(t,r=void 0,n=0,e=m){return d(t,r,void 0,n,e)}const G={PerformScript:O,PerformScriptWithOption:d};window.FMGofer=G;

</script>
  <style type="text/css">
*{font-family:Arial,Helvetica,sans-serif;color:#fff;margin:10px;text-align:center}body{background-color:#223339}button{padding:10pt;font-size:medium;border:.5pt solid #007fb5;border-radius:5pt;background-color:#0091ce;color:#fff}button:active{background-color:#007cb1}.message{margin-top:10pt;margin-bottom:10pt;font-size:large}.loader{color:#9c9c9c;font-size:20px;margin:100px auto;width:1em;height:1em;border-radius:50%;position:relative;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,to{box-shadow:0 -3em 0 .2em,2em -2em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em}12.5%{box-shadow:0 -3em,2em -2em 0 .2em,3em 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em,3em 0 0 .2em,2em 2em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0,2em 2em 0 .2em,0 3em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em,0 3em 0 .2em,-2em 2em,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em,-2em 2em 0 .2em,-3em 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0 0 .2em,-2em -2em}87.5%{box-shadow:0 -3em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0,-2em -2em 0 .2em}}@keyframes load4{0%,to{box-shadow:0 -3em 0 .2em,2em -2em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em}12.5%{box-shadow:0 -3em,2em -2em 0 .2em,3em 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em,3em 0 0 .2em,2em 2em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0,2em 2em 0 .2em,0 3em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em,0 3em 0 .2em,-2em 2em,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em,-2em 2em 0 .2em,-3em 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0 0 .2em,-2em -2em}87.5%{box-shadow:0 -3em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em,-3em 0,-2em -2em 0 .2em}}

</style>
</head>

<body>
  <button id="myButton">Click Me</button>
  <div id="message" class="message">Click the button to get a message</div>
  <div id="loader" class="loader" hidden>Loading...</div>
  <script>
    (async function () {
      async function handleClick() {
        console.log('askForJson', askForJson)
        const script = 'FM Script';
        const param = 'HELLO FROM JS ' + new Date();
        const timeout = 1000;
        const timeoutMessage = 'Custom timeout message. The webviewer code elected to only wait for ' + timeout + 'ms.';
        updateMessage('Waiting...');
        showLoader();
        FMGofer.PerformScriptWithOption(script, param, Option.Default, timeout, timeoutMessage)
          .then(function (result) {
            hideLoader();
            updateMessage(result, 'üòç');
          })
          .catch(function (error) {
            hideLoader();
            updateMessage(error, 'üòµ');
          });
      }
      function showLoader() {
        document.getElementById('loader').hidden = false;
      }
      function hideLoader() {
        document.getElementById('loader').hidden = true;
      }
      function updateMessage(message, emoji) {
        var html = message;
        if (emoji) {
          html += '<div style="font-size: 4rem;">' + emoji + '</div>';
        }

      } else {
        try {
          const param = 'HELLO FROM JS ' + new Date();
          const res = await FMGofer.PerformScript(script, param, timeout, timeoutMessage);
          updateMessage(res, 'üòç');
        } catch (error) {
          updateMessage(error, 'üòµ');
        } finally {
          hideLoader();
        }
      }
    }
      function showLoader() {
      document.getElementById('loader').hidden = false;
    }
    function hideLoader() {
      document.getElementById('loader').hidden = true;
    }
    function updateMessage(message, emoji) {
      var html = message;
      if (emoji) {
        html += '<div style="font-size: 4rem;">' + emoji + '</div>';
      }
      document.getElementById('message').innerHTML = html;
    }

    document.getElementById('myButtonJSON').onclick = () => handleClick(true);
    document.getElementById('myButton').onclick = () => handleClick(false);
    }) ();
  </script>
</body>

</html>