<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fm-gofer example</title>
  <!-- Scroll to the body for example usage -->
  <link rel="stylesheet" href="index.css">
  <script type="module">
    import FMGofer from '../../dist/fm-gofer'
    window.FMGofer = FMGofer;
  </script>
</head>

<body>
  <button id="myButtonJSON">Click For JSON</button>
  <button id="myButton">Click For... Not JSON</button>
  <div id="message" class="message">Click the button to get a message</div>
  <div id="loader" class="loader" hidden>Loading...</div>
  <script>
    (async function () {
      async function handleClick(askForJson = false) {
        console.log('askForJson', askForJson)
        const script = 'FM Script';
        const timeout = 1000;
        const timeoutMessage = 'Custom timeout message. The webviewer code elected to only wait for ' + timeout + 'ms.';
        updateMessage('Waiting...');
        showLoader();
        if (askForJson) {
          const param = "DEAR FM, PLEASE SEND JSON!";
          try {
            const res = await FMGofer.PerformScript(script, param, timeout, timeoutMessage).json();
            console.log('res', res);
            // re-stringifying the parsed json to display in ui, but you can view the parsed json in the console
            updateMessage(JSON.stringify(res), 'ü§ñ');
          } catch (error) {
            updateMessage(error, 'üòµ');
          } finally {
            hideLoader();
          }

        } else {
          try {
            const param = 'HELLO FROM JS ' + new Date();
            const res = await FMGofer.PerformScript(script, param, timeout, timeoutMessage);
            updateMessage(res, 'üòç');
          } catch (error) {
            updateMessage(error, 'üòµ');
          } finally {
            hideLoader();
          }
        }
      }
      function showLoader() {
        document.getElementById('loader').hidden = false;
      }
      function hideLoader() {
        document.getElementById('loader').hidden = true;
      }
      function updateMessage(message, emoji) {
        var html = message;
        if (emoji) {
          html += '<div style="font-size: 4rem;">' + emoji + '</div>';
        }
        document.getElementById('message').innerHTML = html;
      }

      document.getElementById('myButtonJSON').onclick = () => handleClick(true);
      document.getElementById('myButton').onclick = () => handleClick(false);
    })();
  </script>
</body>

</html>